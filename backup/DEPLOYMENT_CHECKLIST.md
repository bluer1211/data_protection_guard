# Data Protection Guard Plugin 部署檢查清單

## 部署前準備

### 1. 環境檢查
- [ ] 確認 Redmine 版本相容性（支援 4.0+）
- [ ] 確認 Ruby 版本（建議 2.7+）
- [ ] 確認 Rails 版本相容性
- [ ] 檢查資料庫連線正常
- [ ] 確認檔案系統權限

### 2. 備份準備
- [ ] 備份 Redmine 資料庫
- [ ] 備份現有插件設定
- [ ] 備份自訂主題和檔案
- [ ] 記錄當前系統狀態

### 3. 測試環境驗證
- [ ] 在測試環境中部署插件
- [ ] 驗證基本功能正常
- [ ] 測試個人資料偵測功能
- [ ] 測試機敏資料偵測功能
- [ ] 測試欄位排除功能
- [ ] 測試專案排除功能

## 部署步驟

### 1. 插件安裝
- [ ] 將插件檔案複製到 `plugins/data_protection_guard/` 目錄
- [ ] 確認檔案權限正確
- [ ] 重新啟動 Redmine 服務
- [ ] 檢查插件是否正確載入

### 2. 資料庫遷移
- [ ] 執行資料庫遷移：`bundle exec rake redmine:plugins:migrate RAILS_ENV=production`
- [ ] 確認遷移成功
- [ ] 檢查資料表是否正確建立

### 3. 設定配置
- [ ] 進入 Redmine 管理介面
- [ ] 前往「管理」→「插件」→「Data Protection Guard」
- [ ] 配置基本設定：
  - [ ] 啟用個人資料偵測
  - [ ] 啟用機敏資料偵測
  - [ ] 設定阻擋提交選項
  - [ ] 配置日誌記錄選項
- [ ] 配置偵測規則：
  - [ ] 個人資料模式
  - [ ] 機敏資料模式
  - [ ] 排除欄位清單
  - [ ] 排除專案清單
- [ ] 儲存設定

### 4. 功能驗證
- [ ] 測試問題建立功能
- [ ] 測試問題編輯功能
- [ ] 測試筆記欄位個人資料偵測
- [ ] 測試描述欄位個人資料偵測
- [ ] 測試主旨欄位個人資料偵測
- [ ] 測試檔案上傳功能
- [ ] 測試欄位排除功能
- [ ] 測試專案排除功能

## 筆記欄位修復特別檢查

### 1. 正則表達式修復驗證
- [ ] 確認 `init.rb` 中的身分證號模式已修復
- [ ] 測試中文環境下的身分證號偵測
- [ ] 驗證以下測試案例：
  - [ ] "A123456789"
  - [ ] "身分證號 A123456789"
  - [ ] "ID: A123456789"
  - [ ] "包含 A123456789 的內容"
  - [ ] "A123456789 測試"
  - [ ] "用戶身分證號是 A123456789"

### 2. 欄位排除功能驗證
- [ ] 確認 `notes` 欄位沒有被排除
- [ ] 測試 `excluded_fields` 設定功能
- [ ] 驗證欄位排除邏輯正確

### 3. 測試腳本執行
- [ ] 執行 `verify_notes_fix.rb` 測試腳本
- [ ] 確認所有測試通過
- [ ] 檢查測試結果報告

## 部署後檢查

### 1. 功能測試
- [ ] 建立測試問題並在筆記欄位輸入個人資料
- [ ] 確認偵測功能正常運作
- [ ] 確認錯誤訊息正確顯示
- [ ] 測試阻擋提交功能
- [ ] 測試日誌記錄功能

### 2. 效能檢查
- [ ] 監控系統回應時間
- [ ] 檢查記憶體使用量
- [ ] 監控資料庫查詢效能
- [ ] 確認沒有明顯效能下降

### 3. 日誌檢查
- [ ] 檢查應用程式日誌
- [ ] 檢查資料保護日誌
- [ ] 確認錯誤日誌正常
- [ ] 檢查個人資料偵測日誌

### 4. 使用者體驗
- [ ] 測試一般使用者操作流程
- [ ] 確認錯誤訊息友善易懂
- [ ] 測試管理員設定介面
- [ ] 確認功能符合預期

## 故障排除

### 1. 常見問題
- [ ] 插件無法載入：檢查檔案權限和路徑
- [ ] 資料庫錯誤：檢查遷移是否成功
- [ ] 設定無法儲存：檢查資料庫連線
- [ ] 偵測功能異常：檢查正則表達式模式

### 2. 筆記欄位特別問題
- [ ] 筆記欄位沒有偵測：檢查 `excluded_fields` 設定
- [ ] 身分證號無法偵測：檢查正則表達式模式
- [ ] 中文環境問題：確認模式已修復

### 3. 回滾準備
- [ ] 準備回滾腳本
- [ ] 備份當前設定
- [ ] 準備資料庫回滾方案
- [ ] 準備服務重啟方案

## 監控和維護

### 1. 持續監控
- [ ] 設定效能監控
- [ ] 設定錯誤監控
- [ ] 設定日誌監控
- [ ] 設定使用者回饋收集

### 2. 定期檢查
- [ ] 每月檢查功能正常性
- [ ] 每季檢查效能表現
- [ ] 定期更新偵測規則
- [ ] 定期檢查安全性

### 3. 更新維護
- [ ] 監控插件更新
- [ ] 準備更新流程
- [ ] 測試更新相容性
- [ ] 準備回滾方案

## 文件更新

### 1. 技術文件
- [ ] 更新安裝文件
- [ ] 更新設定文件
- [ ] 更新故障排除文件
- [ ] 更新 API 文件

### 2. 使用者文件
- [ ] 更新使用者手冊
- [ ] 更新管理員手冊
- [ ] 更新常見問題
- [ ] 更新最佳實踐

### 3. 開發文件
- [ ] 更新開發指南
- [ ] 更新測試文件
- [ ] 更新貢獻指南
- [ ] 更新版本記錄

## 簽署確認

**部署負責人**: _________________  
**部署日期**: _________________  
**部署環境**: _________________  
**部署狀態**: _________________  

**驗證人員**: _________________  
**驗證日期**: _________________  
**驗證結果**: _________________  

**備註**:
