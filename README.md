# Data Protection Guard Plugin for Redmine

## 概述

Data Protection Guard 是一個 Redmine 插件，用於防止機敏資料與個人資料的提交與儲存。該插件會自動檢查 Issue、Journal 和 Attachment 中的內容，偵測並阻止包含機敏資訊或個人資料的提交。

## 功能特色

### 機敏資料偵測
- FTP/SFTP/SSH 帳號與密碼
- 伺服器或系統 IP 位址
- 資料庫帳號與密碼
- API Key、Token、憑證檔
- 內部網域名稱、伺服器路徑
- 私鑰和憑證內容

### 個人資料偵測
- 姓名、身分證號、護照號碼
- 電話號碼、電子郵件、住址
- 銀行帳號、信用卡號
- 出生日期
- 台灣地區地址

### 核心功能
- 自動驗證提交內容
- 可設定阻擋或僅記錄違規
- 詳細的違規日誌記錄
- 支援排除特定欄位和專案
- 正則表達式測試工具
- CSV 匯出功能

## 安裝

1. 將插件複製到 `redmine/plugins/` 目錄
2. 重新啟動 Redmine
3. 進入管理員設定頁面啟用插件
4. 設定偵測規則和排除項目

## 設定

### 基本設定
- **啟用機敏資料偵測**: 開啟機敏資料檢查功能
- **啟用個人資料偵測**: 開啟個人資料檢查功能
- **阻擋違規提交**: 阻止包含違規內容的提交
- **記錄違規事件**: 記錄所有違規事件到日誌
- **記錄到資料庫**: 將違規事件儲存到資料庫

### 偵測規則
插件預設包含以下偵測規則：

#### 機敏資料規則
```
ftp://[^\s]+
sftp://[^\s]+
ssh://[^\s]+
\b(?:password|pwd|passwd)\s*[:=]\s*[^\s]+
\b(?:api_key|api_token|access_token|secret_key)\s*[:=]\s*[^\s]+
\b(?:192\.168\.|10\.|172\.(?:1[6-9]|2[0-9]|3[0-1])\.)\d+\.\d+\b
\b(?:localhost|127\.0\.0\.1)\b
\b(?:root@|admin@)[^\s]+
\b(?:mysql|postgresql|mongodb)://[^\s]+
\b(?:BEGIN|END)\s+(?:RSA|DSA|EC)\s+PRIVATE KEY\b
\b(?:BEGIN|END)\s+CERTIFICATE\b
```

#### 個人資料規則
```
\b[A-Z][a-z]+\s+[A-Z][a-z]+\b
\b[A-Z]\d{9}\b
\b[A-Z]\d{8}\b
\b\d{4}-\d{4}-\d{4}-\d{4}\b
\b\d{10,16}\b
\b\d{2,4}-\d{3,4}-\d{4}\b
\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b
\b\d{4}-\d{2}-\d{2}\b
\b(?:台北市|新北市|桃園市|台中市|台南市|高雄市|基隆市|新竹市|新竹縣|苗栗縣|彰化縣|南投縣|雲林縣|嘉義市|嘉義縣|屏東縣|宜蘭縣|花蓮縣|台東縣|澎湖縣|金門縣|連江縣)[^\s]*\b
```

### 排除設定
- **排除欄位**: 指定不進行檢查的欄位（如：subject, tracker_id）
- **排除專案**: 指定不進行檢查的專案識別碼

## 使用方式

### 管理員功能
1. 進入管理員選單 → 資料保護
2. 設定偵測規則和排除項目
3. 使用測試工具驗證正則表達式
4. 查看違規日誌和統計

### 使用者體驗
- 提交包含機敏資料的內容時會收到錯誤訊息
- 錯誤訊息會指出具體的違規內容
- 可以修改內容後重新提交

## 日誌功能

### 日誌查看
- 查看所有違規事件
- 按使用者、類型、日期篩選
- 匯出 CSV 格式報告
- 清除舊日誌記錄

### 日誌內容
- 違規時間和使用者
- 違規類型和嚴重程度
- 匹配的內容
- IP 位址和上下文資訊

## 技術架構

### 模型擴展
- `Issue`: 檢查描述和主旨欄位
- `Journal`: 檢查備註和詳細變更
- `Attachment`: 檢查檔案名稱、描述和文字檔案內容

### 核心模組
- `DataProtectionGuard`: 主要功能模組
- `DataProtectionLogger`: 日誌記錄模組
- `SensitiveDataValidator`: 機敏資料驗證器
- `PersonalDataValidator`: 個人資料驗證器

## 安全性考量

### 資料保護
- 不儲存實際的機敏資料內容
- 僅記錄違規事件的基本資訊
- 支援資料庫日誌清理功能

### 效能優化
- 僅在內容變更時進行檢查
- 限制檔案內容檢查大小（1MB）
- 支援排除特定欄位和專案

## 故障排除

### 常見問題
1. **正則表達式錯誤**: 使用測試工具驗證語法
2. **誤判問題**: 調整偵測規則或使用排除設定
3. **效能問題**: 減少檢查的檔案大小限制

### 日誌檢查
- 查看 Rails 日誌檔案
- 檢查資料保護日誌頁面
- 確認設定是否正確

## 開發資訊

### 版本
- 當前版本: 1.0.0
- 支援 Redmine 版本: 6.0.6+
- 授權: GPL v2

### 貢獻
歡迎提交 Issue 和 Pull Request 來改善插件功能。

### 授權
本插件採用 GNU General Public License v2 授權。
