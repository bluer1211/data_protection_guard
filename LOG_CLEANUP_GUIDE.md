# è³‡æ–™ä¿è­·æ—¥èªŒæ¸…ç†æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—èªªæ˜å¦‚ä½•ä½¿ç”¨ Data Protection Guard æ’ä»¶çš„æ—¥èªŒæ¸…ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬è³‡æ–™åº«è¨˜éŒ„æ¸…ç†ã€æ—¥èªŒæª”æ¡ˆæ¸…ç†å’Œçµ±è¨ˆåˆ†æã€‚

## âš ï¸ é‡è¦èªªæ˜

**å®šæœŸæ¸…ç†åŠŸèƒ½å°ä¸åŒè¨˜éŒ„é¡å‹çš„å½±éŸ¿**ï¼š

- âœ… **è³‡æ–™åº«è¨˜éŒ„**: å®Œå…¨æœ‰æ•ˆï¼Œç›´æ¥æ¸…ç†è³‡æ–™åº«è¡¨æ ¼
- âŒ **æ—¥èªŒæª”æ¡ˆè¨˜éŒ„**: ç„¡æ•ˆï¼Œéœ€è¦é¡å¤–è¨­å®šç³»çµ±æ—¥èªŒæ¸…ç†

## ğŸ§¹ æ¸…ç†åŠŸèƒ½é¡å‹

### 1. è³‡æ–™åº«è¨˜éŒ„æ¸…ç†ï¼ˆæ’ä»¶åŠŸèƒ½ï¼‰

#### æ‰‹å‹•æ¸…ç†

#### é€éç®¡ç†ä»‹é¢
1. é€²å…¥ **ç®¡ç†** â†’ **è³‡æ–™ä¿è­·æ—¥èªŒ**
2. é»æ“Š **æ¸…é™¤æ—¥èªŒ** æŒ‰éˆ•
3. é¸æ“‡æ¸…ç†é¡å‹ï¼š
   - **å…¨éƒ¨è¨˜éŒ„**: æ¸…ç†æ‰€æœ‰é¡å‹çš„èˆŠè¨˜éŒ„
   - **æ©Ÿæ•è³‡æ–™**: åªæ¸…ç†æ©Ÿæ•è³‡æ–™è¨˜éŒ„
   - **å€‹äººè³‡æ–™**: åªæ¸…ç†å€‹äººè³‡æ–™è¨˜éŒ„
   - **ç‰¹å®šä½¿ç”¨è€…**: æ¸…ç†ç‰¹å®šä½¿ç”¨è€…çš„è¨˜éŒ„
4. è¨­å®šæ¸…ç†å¤©æ•¸ï¼ˆé è¨­ 30 å¤©ï¼‰
5. ç¢ºèªåŸ·è¡Œ

#### é€é Rake ä»»å‹™
```bash
# æ¸…ç† 30 å¤©å‰çš„æ‰€æœ‰è¨˜éŒ„
bundle exec rake data_protection_guard:clear_old_logs[30]

# æ¸…ç† 60 å¤©å‰çš„æ©Ÿæ•è³‡æ–™è¨˜éŒ„
bundle exec rake data_protection_guard:clear_logs_by_type[sensitive_data,60]

# æ¸…ç† 45 å¤©å‰çš„å€‹äººè³‡æ–™è¨˜éŒ„
bundle exec rake data_protection_guard:clear_logs_by_type[personal_data,45]

# é¡¯ç¤ºçµ±è¨ˆè³‡è¨Š
bundle exec rake data_protection_guard:statistics
```

#### è‡ªå‹•æ¸…ç†

#### è¨­å®šè‡ªå‹•æ¸…ç†
1. é€²å…¥ **ç®¡ç†** â†’ **è³‡æ–™ä¿è­·è¨­å®š**
2. è¨­å®š **è‡ªå‹•æ¸…ç†å¤©æ•¸**ï¼ˆé è¨­ 30 å¤©ï¼‰
3. å„²å­˜è¨­å®š

#### è¨­å®š Cron ä»»å‹™
```bash
# ç·¨è¼¯ crontab
crontab -e

# æ·»åŠ æ¯æ—¥å‡Œæ™¨ 2 é»åŸ·è¡Œè‡ªå‹•æ¸…ç†
0 2 * * * cd /path/to/redmine && bundle exec rake data_protection_guard:auto_clean

# æˆ–è€…æ¯é€±æ—¥å‡Œæ™¨ 3 é»åŸ·è¡Œ
0 3 * * 0 cd /path/to/redmine && bundle exec rake data_protection_guard:auto_clean
```

#### Docker ç’°å¢ƒçš„ Cron è¨­å®š
```yaml
# docker-compose.yml
services:
  redmine:
    # ... å…¶ä»–è¨­å®š ...
    command: >
      sh -c "
        echo '0 2 * * * cd /usr/src/redmine && bundle exec rake data_protection_guard:auto_clean' >> /etc/crontab &&
        cron &&
        /docker-entrypoint.sh rails server -b 0.0.0.0
      "
```

## ğŸ“Š çµ±è¨ˆåˆ†æ

### æŸ¥çœ‹çµ±è¨ˆè³‡è¨Š
```bash
# å‘½ä»¤åˆ—æŸ¥çœ‹
bundle exec rake data_protection_guard:statistics

# è¼¸å‡ºç¯„ä¾‹ï¼š
=== è³‡æ–™ä¿è­·æ—¥èªŒçµ±è¨ˆ ===
ç¸½è¨˜éŒ„æ•¸: 1250
æ©Ÿæ•è³‡æ–™è¨˜éŒ„: 450
å€‹äººè³‡æ–™è¨˜éŒ„: 800
ä»Šæ—¥è¨˜éŒ„: 15
æœ¬é€±è¨˜éŒ„: 89
æœ¬æœˆè¨˜éŒ„: 234
æœ€æ—©è¨˜éŒ„: 2025-01-15 10:30:00
æœ€æ–°è¨˜éŒ„: 2025-08-20 14:25:30
```

### é€éç®¡ç†ä»‹é¢
1. é€²å…¥ **ç®¡ç†** â†’ **è³‡æ–™ä¿è­·æ—¥èªŒ**
2. æŸ¥çœ‹çµ±è¨ˆè³‡è¨Šå’Œæœ€è¿‘è¨˜éŒ„

## âš™ï¸ æœ€ä½³å¯¦è¸

### 1. æ¸…ç†ç­–ç•¥å»ºè­°

| ç’°å¢ƒé¡å‹ | æ¸…ç†é »ç‡ | ä¿ç•™å¤©æ•¸ | èªªæ˜ |
|----------|----------|----------|------|
| **é–‹ç™¼ç’°å¢ƒ** | æ¯é€± | 7 å¤© | å¿«é€Ÿæ¸…ç†ï¼Œç¯€çœç©ºé–“ |
| **æ¸¬è©¦ç’°å¢ƒ** | æ¯é€± | 14 å¤© | ä¿ç•™è¼ƒé•·æ™‚é–“ç”¨æ–¼æ¸¬è©¦ |
| **ç”Ÿç”¢ç’°å¢ƒ** | æ¯æ—¥ | 30 å¤© | å¹³è¡¡å„²å­˜ç©ºé–“å’Œå¯©è¨ˆéœ€æ±‚ |
| **é«˜å®‰å…¨æ€§** | æ¯æ—¥ | 90 å¤© | ä¿ç•™æ›´é•·æ™‚é–“ç”¨æ–¼åˆè¦ |

### 2. æ¸…ç†å‰å‚™ä»½
```bash
# å‚™ä»½æ¸…ç†å‰çš„è¨˜éŒ„
bundle exec rake data_protection_guard:statistics > backup_$(date +%Y%m%d).txt

# æˆ–è€…åŒ¯å‡º CSV
# é€éç®¡ç†ä»‹é¢åŒ¯å‡º CSV æª”æ¡ˆ
```

### 3. ç›£æ§æ¸…ç†æ•ˆæœ
```bash
# æ¸…ç†å‰å¾Œæ¯”è¼ƒ
echo "æ¸…ç†å‰çµ±è¨ˆï¼š"
bundle exec rake data_protection_guard:statistics

# åŸ·è¡Œæ¸…ç†
bundle exec rake data_protection_guard:clear_old_logs[30]

echo "æ¸…ç†å¾Œçµ±è¨ˆï¼š"
bundle exec rake data_protection_guard:statistics
```

## ğŸ”§ æ•…éšœæ’é™¤

### 1. æ¸…ç†å¤±æ•—
```bash
# æª¢æŸ¥è³‡æ–™åº«é€£æ¥
bundle exec rake db:migrate:status

# æª¢æŸ¥æ’ä»¶ç‹€æ…‹
bundle exec rake redmine:plugins:status
```

### 2. æ¬Šé™å•é¡Œ
```bash
# ç¢ºä¿ Redmine ç”¨æˆ¶æœ‰å¯«å…¥æ¬Šé™
chown -R redmine:redmine /path/to/redmine
chmod -R 755 /path/to/redmine
```

### 3. æ—¥èªŒæª”æ¡ˆéå¤§
```bash
# æª¢æŸ¥æ—¥èªŒæª”æ¡ˆå¤§å°
du -sh /path/to/redmine/log/*

# æ¸…ç†èˆŠæ—¥èªŒæª”æ¡ˆ
find /path/to/redmine/log -name "*.log" -mtime +30 -delete
```

## ğŸ“ æ³¨æ„äº‹é …

1. **ä¸å¯é€†æ“ä½œ**: æ¸…ç†æ“ä½œç„¡æ³•å¾©åŸï¼Œè«‹è¬¹æ…åŸ·è¡Œ
2. **å‚™ä»½å»ºè­°**: æ¸…ç†å‰å»ºè­°å‚™ä»½é‡è¦è¨˜éŒ„
3. **æ•ˆèƒ½è€ƒé‡**: å¤§é‡è¨˜éŒ„æ¸…ç†å¯èƒ½å½±éŸ¿ç³»çµ±æ•ˆèƒ½
4. **åˆè¦è¦æ±‚**: ç¢ºä¿æ¸…ç†ç­–ç•¥ç¬¦åˆçµ„ç¹”çš„åˆè¦è¦æ±‚
5. **ç›£æ§å»ºè­°**: å®šæœŸæª¢æŸ¥æ¸…ç†ä»»å‹™æ˜¯å¦æ­£å¸¸åŸ·è¡Œ

## ğŸ¯ å»ºè­°é…ç½®

### ç”Ÿç”¢ç’°å¢ƒæ¨è–¦è¨­å®š
```yaml
# è¨­å®šæª”å»ºè­°
auto_cleanup_days: 30          # ä¿ç•™ 30 å¤©
log_to_database: true          # å•Ÿç”¨è³‡æ–™åº«è¨˜éŒ„
log_violations: true           # å•Ÿç”¨æ—¥èªŒæª”æ¡ˆè¨˜éŒ„

# Cron ä»»å‹™
0 2 * * * cd /path/to/redmine && bundle exec rake data_protection_guard:auto_clean
```

---

**æœ€å¾Œæ›´æ–°**: 2025-08-20  
**ç‰ˆæœ¬**: v1.0.2
